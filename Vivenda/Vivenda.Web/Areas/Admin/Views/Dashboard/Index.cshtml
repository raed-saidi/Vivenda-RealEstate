@model Vivenda.BLL.DTOs.DashboardStatsDto
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .page-header {
        margin-bottom: 1.5rem;
    }

    .page-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111;
        margin: 0;
    }

    .page-subtitle {
        font-size: 0.875rem;
        color: #666;
        margin-top: 0.25rem;
    }

    /* Stat Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    @@media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @@media (max-width: 576px) { .stats-grid { grid-template-columns: 1fr; } }

    .stat-card {
        background: #fff;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 1.25rem;
    }

    .stat-card .icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        margin-bottom: 0.875rem;
    }

    .stat-card .icon.blue { background: #dbeafe; color: #2563eb; }
    .stat-card .icon.green { background: #dcfce7; color: #16a34a; }
    .stat-card .icon.purple { background: #f3e8ff; color: #9333ea; }
    .stat-card .icon.orange { background: #ffedd5; color: #ea580c; }

    .stat-card .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111;
        margin-bottom: 0.125rem;
    }

    .stat-card .label {
        font-size: 0.8125rem;
        color: #666;
    }

    /* Cards */
    .card {
        background: #fff;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }

    .card-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #e5e5e5;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .card-title {
        font-size: 0.9375rem;
        font-weight: 600;
        color: #111;
        margin: 0;
    }

    .card-body { padding: 1.25rem; }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 280px;
    }

    /* Table */
    .table {
        margin: 0;
    }

    .table th {
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #999;
        border-bottom: 1px solid #e5e5e5;
        padding: 0.625rem 1rem;
        background: #fafafa;
    }

    .table td {
        font-size: 0.8125rem;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e5e5e5;
        vertical-align: middle;
        color: #333;
    }

    .table tbody tr:last-child td { border-bottom: none; }
    .table tbody tr:hover { background: #fafafa; }

    /* Badge */
    .badge {
        font-weight: 500;
        font-size: 0.6875rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
    }

    .badge-success { background: #dcfce7; color: #166534; }
    .badge-warning { background: #fef3c7; color: #92400e; }
    .badge-info { background: #dbeafe; color: #1e40af; }

    /* Quick Stats Row */
    .quick-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    @@media (max-width: 768px) { .quick-stats { grid-template-columns: 1fr; } }

    .quick-stat {
        background: #fff;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        padding: 1rem 1.25rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .quick-stat .info .label {
        font-size: 0.75rem;
        color: #666;
        margin-bottom: 0.125rem;
    }

    .quick-stat .info .value {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111;
    }

    .quick-stat .badge {
        font-size: 0.75rem;
        padding: 0.375rem 0.625rem;
    }
</style>

<!-- Page Header -->
<div class="page-header">
    <h2 class="page-title">Dashboard Overview</h2>
    <p class="page-subtitle">Welcome back! Here's what's happening with your platform.</p>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="icon blue"><i class="fas fa-building"></i></div>
        <div class="value">@Model.TotalProperties</div>
        <div class="label">Total Properties</div>
    </div>
    <div class="stat-card">
        <div class="icon green"><i class="fas fa-users"></i></div>
        <div class="value">@Model.TotalUsers</div>
        <div class="label">Total Users</div>
    </div>
    <div class="stat-card">
        <div class="icon purple"><i class="fas fa-envelope"></i></div>
        <div class="value">@Model.TotalInquiries</div>
        <div class="label">Total Inquiries</div>
    </div>
    <div class="stat-card">
        <div class="icon orange"><i class="fas fa-folder"></i></div>
        <div class="value">@Model.TotalCategories</div>
        <div class="label">Categories</div>
    </div>
</div>

<!-- Quick Stats -->
<div class="quick-stats">
    <div class="quick-stat">
        <div class="info">
            <div class="label">For Sale</div>
            <div class="value">@Model.PropertiesForSale</div>
        </div>
        <span class="badge badge-success">Sale</span>
    </div>
    <div class="quick-stat">
        <div class="info">
            <div class="label">For Rent</div>
            <div class="value">@Model.PropertiesForRent</div>
        </div>
        <span class="badge badge-info">Rent</span>
    </div>
    <div class="quick-stat">
        <div class="info">
            <div class="label">Unread Messages</div>
            <div class="value">@Model.UnreadInquiries</div>
        </div>
        <span class="badge badge-warning">Pending</span>
    </div>
</div>

<!-- Charts Row -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Monthly Activity</h3>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Properties by Category</h3>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tables Row -->
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Properties</h3>
                <a href="/Admin/Properties" class="btn btn-sm btn-outline-secondary">View All</a>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Price</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var property in Model.RecentProperties.Take(5))
                        {
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">@(property.Title.Length > 25 ? property.Title.Substring(0, 25) + "..." : property.Title)</div>
                                    <div style="font-size: 0.75rem; color: #999;">@property.City, @property.State</div>
                                </td>
                                <td>$@property.Price.ToString("N0")</td>
                                <td>
                                    <span class="badge @(property.Status == "Active" ? "badge-success" : "badge-warning")">
                                        @property.Status
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Messages</h3>
                <a href="/Admin/Messages" class="btn btn-sm btn-outline-secondary">View All</a>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>From</th>
                            <th>Subject</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var inquiry in Model.RecentInquiries.Take(5))
                        {
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">@inquiry.SenderName</div>
                                    <div style="font-size: 0.75rem; color: #999;">@inquiry.SenderEmail</div>
                                </td>
                                <td>@(inquiry.Subject != null && inquiry.Subject.Length > 20 ? inquiry.Subject.Substring(0, 20) + "..." : inquiry.Subject ?? "No Subject")</td>
                                <td>
                                    <span class="badge @(inquiry.IsRead ? "badge-success" : "badge-warning")">
                                        @(inquiry.IsRead ? "Read" : "Unread")
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Activity Chart
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        new Chart(activityCtx, {
            type: 'line',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.MonthlyStats.Select(s => $"'{s.Month}'")))],
                datasets: [{
                    label: 'Properties',
                    data: [@string.Join(",", Model.MonthlyStats.Select(s => s.PropertiesAdded))],
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Inquiries',
                    data: [@string.Join(",", Model.MonthlyStats.Select(s => s.InquiriesReceived))],
                    borderColor: '#16a34a',
                    backgroundColor: 'transparent',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#f0f0f0' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Category Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.CategoryStats.Select(s => $"'{s.CategoryName}'")))],
                datasets: [{
                    data: [@string.Join(",", Model.CategoryStats.Select(s => s.PropertyCount))],
                    backgroundColor: ['#2563eb', '#16a34a', '#9333ea', '#ea580c', '#0891b2', '#dc2626']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    </script>
}

